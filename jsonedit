#!/usr/bin/python
# jsonedit - urwid-based JSON editor
#
# Copyright (c) 2010, Rob Lanphier
# All rights reserved.  
# Licensed under BSD-style license.  See LICENSE.txt for details.

import json
import urwid.curses_display
import urwid
import optparse

from jsonschema import *
from jsonforms_urwid import *

# Force monochrome for now.  Will probably revisit when 0.9.9 is widely 
# deployed
urwid.curses_display.curses.has_colors = lambda : False

def show_form(schema, jsondata=None):
    # a full schema object is the root node of a tree of SchemaNodes
    schemaobj=SchemaNode('root', schema)
    # a full json object is the root node of a tree of JsonNodes
    jsonobj=JsonNode('root', jsondata, schemanode=schemaobj)
    form=EntryForm(jsonobj)
    form.run()

def main():
    usage = "usage: %prog [options] arg"
    parser = optparse.OptionParser(usage)
    parser.add_option("-s", "--schema", dest="schema",
                      default="simpleaddr-schema.json",
                      help="use this schema to build the form")
    (options, args) = parser.parse_args()
    if len(args) > 1:
        parser.error("Too many arguments.  Just one .json file at a time, please.")
    schema = json.load(open(options.schema))
    if len(args)==1:
        jsondata = json.load(open(args[0]))
    else:
        jsondata = None
    show_form(schema, jsondata=jsondata)

if __name__ == "__main__":
    main()


